version: 2

models:
  - name: CTL_CONTROL_RESULTS_OVER_TIME
    description: >
      Time-series aggregate table showing control results over time.
      Pivots 11 control types into columns with counts for OK/KO/NA/NULL statuses.
      Data is aggregated by month, channel, and document category.
    meta:
      owner: Fraud Team / dan_leds@document_fraud.com
    tests:
      - unique:
          column_name: unique_key
    columns:
      - name: issue_date
        description: Month of the control (truncated to first of month)
        tests:
          - not_null
      - name: channel_acquisition_id
        description: Acquisition channel identifier
        tests:
          - not_null
      - name: document_category
        description: Document category type
        tests:
          - not_null
      - name: ctl01_count_document
        description: Count of documents for address_consistency control
      - name: ctl01_count_ok
        description: OK count for address_consistency
      - name: ctl01_count_ko
        description: KO count for address_consistency
      - name: ctl01_count_na
        description: NA count for address_consistency
      - name: ctl01_count_null
        description: NULL count for address_consistency
      - name: ctl02_count_document
        description: Count of documents for address_locality_consistency control
      - name: ctl03_count_document
        description: Count of documents for alternate_family_name_consistency control
      - name: ctl04_count_document
        description: Count of documents for alternate_family_name_detection control
      - name: ctl05_count_document
        description: Count of documents for bic_iban_consistency control
      - name: ctl06_count_document
        description: Count of documents for birthdate_mrz_consistency control
      - name: ctl07_count_document
        description: Count of documents for date_validation control
      - name: ctl08_count_document
        description: Count of documents for family_name_account_holder_search control
      - name: ctl09_count_document
        description: Count of documents for family_name_consistency control
      - name: ctl10_count_document
        description: Count of documents for family_name_search control
      - name: ctl11_count_document
        description: Count of documents for personal_id_consistency control
      - name: unique_key
        description: MD5 hash of issue_date, channel, and category for uniqueness
        tests:
          - not_null
